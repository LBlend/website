---
const { artist, track } = Astro.props;
import { Image } from "astro:assets";
import PlaceholderSongImage from "@assets/images/placeholder_song.jpg";

const params = new URLSearchParams({
  method: "track.getInfo",
  format: "json",
  api_key: import.meta.env.LASTFM_API_KEY || "",
  artist: artist,
  track: track,
  username: import.meta.env.LASTFM_USERNAME || "",
});

const res = await fetch(`${import.meta.env.LASTFM_URL}?` + params, {
  method: "GET",
  cache: "force-cache",
});

const trackData = await res.json();

const images = trackData?.track?.album?.image || [];
const mediumImage = images.find((img: { size: string }) => img.size === "medium")?.["#text"];
const imageSrc = mediumImage || PlaceholderSongImage;
---

<Image src={imageSrc} alt={`Cover for ${trackData.track.name}`} width={64} height={64} class="min-h-64px min-w-64px" />
